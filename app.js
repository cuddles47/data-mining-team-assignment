(()=>{"use strict";var e={7:e=>{var t,n="object"==typeof Reflect?Reflect:null,o=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var l=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,o){function l(n){e.removeListener(t,r),o(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",l),n([].slice.call(arguments))}f(e,t,r,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,l)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var i=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function s(e,t,n,o){var l,r,i,s;if(d(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),i=r[t]),void 0===i)i=r[t]=n,++e._eventsCount;else if("function"==typeof i?i=r[t]=o?[n,i]:[i,n]:o?i.unshift(n):i.push(n),(l=a(e))>0&&i.length>l&&!i.warned){i.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=i.length,s=c,console&&console.warn&&console.warn(s)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},l=c.bind(o);return l.listener=n,o.wrapFn=l,l}function h(e,t,n){var o=e._events;if(void 0===o)return[];var l=o[t];return void 0===l?[]:"function"==typeof l?n?[l.listener||l]:[l]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(l):u(l,l.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function u(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e[o];return n}function f(e,t,n,o){if("function"==typeof e.on)o.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function l(r){o.once&&e.removeEventListener(t,l),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e||e<0||l(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||l(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return a(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var l="error"===e,r=this._events;if(void 0!==r)l=l&&void 0===r.error;else if(!l)return!1;if(l){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var d=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw d.context=i,d}var a=r[e];if(void 0===a)return!1;if("function"==typeof a)o(a,this,t);else{var s=a.length,c=u(a,s);for(n=0;n<s;++n)o(c[n],this,t)}return!0},r.prototype.addListener=function(e,t){return s(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return s(this,e,t,!0)},r.prototype.once=function(e,t){return d(t),this.on(e,p(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,p(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,o,l,r,i;if(d(t),void 0===(o=this._events))return this;if(void 0===(n=o[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(l=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){i=n[r].listener,l=r;break}if(l<0)return this;0===l?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,l),1===n.length&&(o[e]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",e,i||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var l,r=Object.keys(n);for(o=0;o<r.length;++o)"removeListener"!==(l=r[o])&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},r.prototype.listeners=function(e){return h(this,e,!0)},r.prototype.rawListeners=function(e){return h(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},123:(e,t,n)=>{n.r(t),n.d(t,{fpgrowth:()=>r});class o{constructor(e,t=null){this.item=e,this.count=1,this.parent=t,this.children=new Map,this.next=void 0}}class l{constructor(){this.root=new o(null),this.headerTable=new Map}addTransaction(e,t=1){let n=this.root;for(const l of e){if(n.children.has(l))n.children.get(l).count+=t;else{const e=new o(l,n);if(e.count=t,n.children.set(l,e),this.headerTable.has(l)){let t=this.headerTable.get(l);for(;void 0!==t.next;)t=t.next;t.next=e}else this.headerTable.set(l,e)}n=n.children.get(l)}}getConditionalPatternBase(e){const t=[];let n=this.headerTable.get(e);for(;n;){let e=[],o=n.parent;for(;o&&o.item;)e.push(o.item),o=o.parent;e.length>0&&t.push({pattern:e.reverse(),count:n.count}),n=n.next}return t}}function r(e,t){const n=[],o=new Map;for(const t of e)for(const e of t)o.set(e,(o.get(e)||0)+1);const r=Array.from(o.entries()).filter((([e,n])=>n>=t)).sort(((e,t)=>t[1]!==e[1]?t[1]-e[1]:e[0].localeCompare(t[0]))).map((([e])=>e));if(0===r.length)return{frequentItemsets:[],logs:n,frequentItemsetsData:[],treeNodes:[]};r.forEach((e=>{const t=o.get(e)||0;n.push(`Item: ${e}, Support Count: ${t}`)}));const i=new l;for(const t of e){const e=t.filter((e=>r.includes(e))).sort(((e,t)=>r.indexOf(e)-r.indexOf(t)));i.addTransaction(e),n.push(`Filtered Transaction: ${e.join(", ")}`)}const d=[];n.push("FP-Tree Structure:"),function e(t,n="",o=0){null!==t.item&&d.push({label:`${t.item} (${t.count})`,depth:o});for(const l of t.children.values())e(l,n+"  ",o+1)}(i.root);const a=[],s=[];return s.sort(((e,t)=>t.support-e.support)),function(e,o=[]){const i=r.filter((t=>e.headerTable.has(t))).reverse();for(const d of i){let c=0,p=e.headerTable.get(d);for(;p;)c+=p.count,p=p.next;if(console.log(`Support Count: ${t}`),c>=t){const h=[d,...o];a.push({items:h,support:c}),n.push(`Frequent Itemset Found: {${h.join(", ")}} with support ${c}`),console.log(`New Itemset Created: {${h.join(", ")}}`);const m=e.getConditionalPatternBase(d);n.push(`Conditional Pattern Base for ${d}: ${JSON.stringify(m)}`);const u=new l;for(const{pattern:T,count:w}of m)u.addTransaction(T,w);const f=[];function g(e,t=""){null!==e.item&&f.push(`${t}${e.item} (${e.count})`);for(const n of e.children.values())g(n,t+"  ")}g(u.root),console.log("Conditional FP-Tree Structure:",f);const y=f.filter((e=>{const n=e.match(/\((\d+)\)$/);return!!n&&parseInt(n[1],10)>=t}));console.log(`Valid Conditional FP-Tree Nodes for ${d}:`,y);const x=[];if(0===y.length){n.push(`No valid nodes in Conditional FP-Tree for ${d} with support >= ${t}`),console.log(`No valid nodes in Conditional FP-Tree for ${d} with support >= ${t}`);const $={items:[d,...o],support:c};x.push($),a.push($),console.log(`Conditional Frequent Itemset (Single Item): {${$.items.join(", ")}} with support ${$.support}`),s.push({x:d,conditionalBase:[],fpTree:[],frequentPatterns:[`{${$.items.join(", ")}}`],support:c});continue}const C=[],v=new Set;for(const M of y){const k=M.trim();v.has(k)||(v.add(k),C.push(M))}function b(e){const t=[[]];for(const n of e){const e=t.length;for(let o=0;o<e;o++)t.push([...t[o],n])}return t}console.log(C);const E=b(C.map((e=>{var t;return null===(t=e.match(/^(.+?) \((\d+)\)$/))||void 0===t?void 0:t[1]})).filter(Boolean));for(const L of E){const A=Array.from(new Set([d,...L,...o])).sort(),I=Math.min(...C.map((e=>{var t;return parseInt((null===(t=e.match(/\((\d+)\)$/))||void 0===t?void 0:t[1])||"0",10)}))),S=A.join(",");x.some((e=>e.items.join(",")===S))||(x.push({items:A,support:I}),a.push({items:A,support:I}),n.push(`Conditional Frequent Itemset: {${A.join(", ")}} with support ${I}`),console.log(`Conditional Frequent Itemset: {${A.join(", ")}} with support ${I}`))}console.log("Conditional Patterns:",x),s.push({x:d,conditionalBase:m.map((e=>`{${e.pattern.join(", ")}: ${e.count}}`)),fpTree:y,frequentPatterns:x.map((e=>`{${e.items.join(", ")}: ${e.support}}`)),support:c})}}}(i),n.push("Frequent Itemsets:"),console.log("Frequent Itemsets:",a),console.log("Frequent Itemsets Data:",s),a.forEach((e=>{n.push(`{${e.items.join(", ")}}: ${e.support}`)})),{frequentItemsets:Array.from(new Map(a.map((e=>[e.items.sort().join(","),e]))).values()),logs:n,frequentItemsetsData:s,treeNodes:d}}}},t={};function n(o){var l=t[o];if(void 0!==l)return l.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o=n(7);class l extends o.EventEmitter{constructor(e){super(),this._hotro=e}thucthi(e,t){return this._giaodich=e,this._hotro=Math.ceil(this._hotro*e.length),new Promise(((e,n)=>{let o=performance.now(),l=[this.layTapMatHangMotPhoBien(this._giaodich)],r=0;for(;l[r].length>0;)l.push(this.layTapMatHangKPhoBien(l[r])),r++;let i=performance.now(),d={tapmathang:l.reduce(((e,t)=>e.concat(t)),[]),thoigianthaotac:Math.round(i-o)};t&&t(d),e(d)}))}layTapMatHangMotPhoBien(e){let t=this._layDemMatHangRieng(e);return Object.keys(t).reduce(((e,n)=>{if(t[n]>=this._hotro){let o={hotro:t[n],mathang:[JSON.parse(n)]};e.push(o),this.emit("data",o)}return e}),[])}layTapMatHangKPhoBien(e){if(!e.length)return[];let t=e[0].mathang.length+1,n=e.reduce(((e,t)=>e.concat(t.mathang)),[]).filter(((e,t,n)=>n.indexOf(e)===t));return this._layDemUngVien(this._taoUngVienK(n,t)).filter((e=>{let t=e.hotro>=this._hotro;return t&&this.emit("data",e),t}))}_taoUngVienK(e,t){if(t>e.length||t<=0)return[];if(t==e.length)return[{mathang:e,hotro:0}];if(1==t)return e.map((e=>({mathang:[e],hotro:0})));let n=[];for(let o=0;o<e.length-t+1;o++){let l=e.slice(o,o+1);this._taoUngVienK(e.slice(o+1),t-1).forEach((e=>n.push({mathang:l.concat(e.mathang),hotro:0})))}return n}_layDemUngVien(e){return this._giaodich.forEach((t=>{e.forEach((e=>{e.mathang.every((e=>-1!==t.indexOf(e)))&&(e.hotro+=1)}))})),e}_layDemMatHangRieng(e){return e.reduce(((e,t)=>t.reduce(((e,t)=>(e[JSON.stringify(t)]=(e[JSON.stringify(t)]||0)+1,e)),e)),{})}}class r{constructor(e,t=100){this.chitietlap=[],this.k=e,this.solaptoida=t}dichuyenvoidulieu(e){if(e.length<this.k)throw new Error(`Cannot cluster ${e.length} points into ${this.k} clusters`);let t=this.khoitaotamcumngaunhien(e);this.chitietlap=[];let n=0,o=!0,l=[],r=[];for(;o&&n<this.solaptoida;){const i=[];for(let n=0;n<e.length;n++){i[n]=[];for(let o=0;o<t.length;o++)i[n][o]=this.khoangcacheuclidean(e[n],t[o])}l=this.ganvaocum(i);const d=Array(this.k).fill(null).map((()=>[]));for(let t=0;t<e.length;t++)d[l[t]].push(e[t]);this.chitietlap.push({bangkhoangcach:i,tamcum:[...t],phancum:[...l]});const a=this.tinhtamcummoi(d);o=this.kiemtratamcumthaydoi(t,a),t=[...a],r=[...d],n++}return{tamcum:t,nhomcum:r,solap:n,chitietlap:this.chitietlap}}khoitaotamcumngaunhien(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t.slice(0,this.k)}khoangcacheuclidean(e,t){let n=0;for(let o=0;o<e.length;o++)n+=Math.pow(e[o]-t[o],2);return Math.round(10*Math.sqrt(n))/10}ganvaocum(e){const t=[];for(let n=0;n<e.length;n++){let o=1/0,l=0;for(let t=0;t<this.k;t++)e[n][t]<o&&(o=e[n][t],l=t);t.push(l)}return t}tinhtamcummoi(e){const t=[];for(let n=0;n<this.k;n++){const o=e[n];if(0===o.length){t.push(this.chitietlap.length>0?this.chitietlap[this.chitietlap.length-1].tamcum[n]:[0,0]);continue}const l=o[0].length,r=new Array(l).fill(0);for(const e of o)for(let t=0;t<l;t++)r[t]+=e[t];for(let e=0;e<l;e++)r[e]=Math.round(r[e]/o.length*10)/10;t.push(r)}return t}kiemtratamcumthaydoi(e,t){for(let n=0;n<this.k;n++)if(this.khoangcacheuclidean(e[n],t[n])>1e-4)return!0;return!1}}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("transactions"),t=document.getElementById("support"),o=document.getElementById("min-confidence"),i=document.getElementById("execute-btn"),d=document.getElementById("import-btn"),a=document.getElementById("frequent-itemsets"),s=document.getElementById("execution-stats"),c=document.getElementById("confidence-group"),p=document.getElementById("algorithm-select"),h=document.getElementById("apriori-params"),m=document.getElementById("kmeans-params"),u=document.getElementById("k-clusters"),f=document.getElementById("max-iterations"),g=document.getElementById("visualization-container"),y=document.getElementById("x-axis"),x=document.getElementById("y-axis"),C=(document.getElementById("cluster-canvas"),document.getElementById("input-title")),v=document.getElementById("input-description"),b={apriori:"A,B,C\nA,C\nC,B,A\nA,B","fp-Growth":"A,B,C\nA,C\nC,B,A\nA,B",kmeans:"1,1\n2,1\n4,3\n5,4"};function E(e,t){const n=new RegExp(`\\s*${t}\\s*(?=(?:[^"]*"[^"]*")*[^"]*$)`);return e.split(n).map((e=>e.replace(/^"|"$/g,"").trim()))}e.placeholder=b[p.value],p.addEventListener("change",(function(){e.placeholder=b[this.value]||b.apriori})),p.addEventListener("change",(()=>{const e=p.value;"apriori"===e?(h.style.display="block",m.style.display="none",g&&(g.style.display="none"),C.textContent="Input Transactions",v.textContent="Enter each transaction on a new line. Items within a transaction should be separated by commas.",i.textContent="apriori"===e?"Execute Apriori":"Execute FP-Growth"):"kmeans"===e?(h.style.display="none",m.style.display="block",C.textContent="Input Data Points",v.textContent="Enter each data point on a new line. Values should be numeric and separated by commas.",i.textContent="Execute K-means"):(h.style.display="block",m.style.display="none",c.style.display="none",C.textContent="Input Transactions",v.textContent="Enter each transaction on a new line. Items within a transaction should be separated by commas.",i.textContent="Execute FP-Growth")})),d.addEventListener("click",(()=>{const t=document.createElement("input");t.type="file",t.accept=".csv, .tsv, .txt",t.style.display="none",document.body.appendChild(t),t.addEventListener("change",(n=>{var o;const l=null===(o=n.target.files)||void 0===o?void 0:o[0];if(!l)return;const r=new FileReader;r.onload=t=>{var n,o;let r=null===(n=t.target)||void 0===n?void 0:n.result;if(!r)return void alert("File is empty or cannot be read.");65279===r.charCodeAt(0)&&(r=r.slice(1));let i=function(e){let t=",",n=0;return[",",";","\t"].forEach((o=>{const l=e.split(o).length;l>n&&(n=l,t=o)})),t}(r.split("\n")[0]);const d=r.split("\n").map((e=>e.trim())).filter((e=>e));if(d.length<=1)return void alert("Invalid CSV format");if(E(d[0],i).length<2)return void alert("CSV must have at least two columns");if("apriori"===p.value){const t=d.slice(1).map((e=>E(e,i).slice(1).join(",")));e.value=t.join("\n")}else{const t=d.slice(1).map((e=>E(e,i).join(",")));e.value=t.join("\n")}const a=document.createElement("div");a.textContent=`File imported successfully: ${l.name}`,a.style.color="green",a.style.marginTop="10px",a.style.padding="5px";const s=document.querySelector(".import-success");s&&s.remove(),a.className="import-success",null===(o=document.querySelector(".input-section"))||void 0===o||o.appendChild(a),setTimeout((()=>{a.remove()}),3e3)},r.onerror=()=>alert("Error reading file."),r.readAsText(l),document.body.removeChild(t)})),t.click()}));const T=document.getElementById("reset-textarea-btn"),w=document.getElementById("sample-data-btn");function $(e){const t=[],n=new Set;for(const t of e)Object.keys(t).forEach((e=>n.add(e)));const o=Array.from(n).sort();for(const n of e){const e=[];for(const t of o)e.push(n[t]||0);t.push(e)}return t}T.addEventListener("click",(()=>{e.value="",t.value="0.5",o.value="0.2",u.value="3",f.value="100",a.innerHTML="",s.innerHTML="",g.style.display="none",y.innerHTML="",x.innerHTML=""})),w.addEventListener("click",(()=>{var t;const n=p.value;e.value=b[n]||"";const o=document.createElement("div");o.textContent="Sample data loaded for "+("apriori"===n?"Apriori":"fp-Growth"===n?"FP-Growth":"K-means Clustering"),o.style.color="green",o.style.marginTop="10px",o.style.padding="5px";const l=document.querySelector(".sample-data-success");l&&l.remove(),o.className="sample-data-success",null===(t=document.querySelector(".input-section"))||void 0===t||t.appendChild(o),setTimeout((()=>{o.remove()}),3e3)})),i.addEventListener("click",(()=>{const i=e.value.trim();i?(a.innerHTML="",s.innerHTML="","apriori"===p.value?function(e){const n=parseFloat(t.value);if(isNaN(n)||n<=0||n>1)return void alert("Support must be a number between 0 and 1");const r=parseFloat(o.value);if(isNaN(r)||r<=0||r>1)return void alert("Minimum confidence must be a number between 0 and 1");const i=e.split("\n").map((e=>e.trim())).filter((e=>e)).map((e=>e.split(",").map((e=>e.trim())))),d=[],c=new l(n);c.on("data",(e=>{d.push(e)})),c.thucthi(i).then((e=>{s.textContent=`Finished executing Apriori. ${e.tapmathang.length} frequent itemsets were found in ${e.thoigianthaotac}ms.`;const t=document.createElement("div");t.className="support-table",t.innerHTML="<h3>Bảng Tần suất các Mục:</h3>";const n=document.createElement("table");n.className="itemset-table",n.style.width="100%",n.style.borderCollapse="collapse",n.style.margin="20px 0",n.style.border="2px solid #ddd";const o=document.createElement("thead"),l=document.createElement("tr");["Tập mục","Support Count","Support %"].forEach((e=>{const t=document.createElement("th");t.textContent=e,t.style.border="1px solid #ddd",t.style.padding="10px",t.style.textAlign="center",t.style.backgroundColor="#f2f2f2",t.style.fontWeight="bold",t.style.borderBottom="2px solid #ddd",l.appendChild(t)})),o.appendChild(l),n.appendChild(o);const c=document.createElement("tbody");[...d].sort(((e,t)=>e.mathang.length!==t.mathang.length?e.mathang.length-t.mathang.length:t.hotro-e.hotro)).forEach((e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=`{${e.mathang.join(", ")}}`,n.style.border="1px solid #ddd",n.style.padding="10px",n.style.textAlign="center",t.appendChild(n);const o=document.createElement("td");o.textContent=e.hotro.toString(),o.style.border="1px solid #ddd",o.style.padding="10px",o.style.textAlign="center",t.appendChild(o);const l=document.createElement("td"),r=(e.hotro/i.length*100).toFixed(2);l.textContent=`${r}%`,l.style.border="1px solid #ddd",l.style.padding="10px",l.style.textAlign="center",t.appendChild(l),c.appendChild(t)})),n.appendChild(c),t.appendChild(n),a.appendChild(t);const p=document.createElement("div");p.innerHTML="<h3>Luật kết hợp:</h3>",d.forEach((e=>{if(e.mathang.length>1)for(let t=0;t<e.mathang.length;t++){const n=[e.mathang[t]],o=e.mathang.filter(((e,n)=>n!==t)),l=d.find((e=>e.mathang.length===o.length&&o.every((t=>e.mathang.includes(t)))));if(l){const t=e.hotro/l.hotro;if(t>=r){const e=document.createElement("div");e.className="rule",e.innerHTML=`{ điều kiện: ['${o.join("', '")}'], kết quả: ['${n.join("', '")}'], min_conf: ${t.toFixed(2)} }`,p.appendChild(document.createElement("br")),p.appendChild(e),p.appendChild(document.createElement("br"))}}}})),a.appendChild(p)})).catch((e=>{console.error("Error executing Apriori:",e),s.textContent=`Error: ${e.message}`}))}(i):"fp-Growth"===p.value?function(e){const t=parseFloat(document.getElementById("support").value);if(isNaN(t)||t<=0||t>1)return void alert("Support must be a number between 0 and 1");const o=e.split("\n").map((e=>e.trim())).filter((e=>e)).map((e=>e.split(",").map((e=>e.trim())))),l=Math.ceil(t*o.length),{fpgrowth:r}=n(123),{frequentItemsets:i,logs:d,frequentItemsetsData:a,treeNodes:s}=r(o,l),c=document.getElementById("results-container");c.innerHTML="";const p=document.createElement("div");p.innerHTML="<h3>Step 2: Frequent Items</h3>";const h=document.createElement("table");h.className="itemset-table",h.style.width="100%",h.style.borderCollapse="collapse",h.style.margin="20px 0",h.style.border="2px solid #ddd";const m=document.createElement("thead"),u=document.createElement("tr");["Item","Support Count"].forEach((e=>{const t=document.createElement("th");t.textContent=e,t.style.border="1px solid #ddd",t.style.padding="10px",t.style.textAlign="center",t.style.backgroundColor="#f2f2f2",t.style.fontWeight="bold",t.style.borderBottom="2px solid #ddd",u.appendChild(t)})),m.appendChild(u),h.appendChild(m);const f=document.createElement("tbody");d.filter((e=>e.startsWith("Item:"))).forEach((e=>{const t=document.createElement("tr"),[n,o]=e.replace("Item: ","").split(", Support Count: "),l=document.createElement("td");l.textContent=n,l.style.border="1px solid #ddd",l.style.padding="10px",l.style.textAlign="center",t.appendChild(l);const r=document.createElement("td");r.textContent=o,r.style.border="1px solid #ddd",r.style.padding="10px",r.style.textAlign="center",t.appendChild(r),f.appendChild(t)})),h.appendChild(f),p.appendChild(h),c.appendChild(p);const g=document.createElement("div");g.innerHTML="<h3>FP-Tree Structure</h3>";let y=document.getElementById("fp-tree");y||(y=document.createElement("pre"),y.id="fp-tree");const x=["Root"];for(let e=0;e<s.length;e++){const t=s[e],n=s[e+1],o=!n||n.depth<=t.depth,l="│   ".repeat(t.depth),r=o?"└── ":"├── ";x.push(`${l}${r}${t.label}`)}y.textContent=x.join("\n"),g.appendChild(y),c.appendChild(g),function(e){const t=document.getElementById("results-container")||document.body,n=document.createElement("div");n.innerHTML="<h3>Kết quả FP-Growth</h3>";const o=document.createElement("table");o.className="itemset-table",o.style.width="100%",o.style.borderCollapse="collapse",o.style.margin="20px 0",o.style.border="2px solid #ddd";const l=document.createElement("thead"),r=document.createElement("tr");["x","Cơ sở mẫu điều kiện","Cây FP-tree","Sinh các mẫu phổ biến"].forEach((e=>{const t=document.createElement("th");t.textContent=e,t.style.border="1px solid #ddd",t.style.padding="10px",t.style.textAlign="center",t.style.backgroundColor="#f2f2f2",t.style.fontWeight="bold",t.style.borderBottom="2px solid #ddd",r.appendChild(t)})),l.appendChild(r),o.appendChild(l);const i=document.createElement("tbody");e.forEach((e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=e.x,n.style.border="1px solid #ddd",n.style.padding="10px",n.style.textAlign="center",t.appendChild(n);const o=document.createElement("td");o.textContent=e.conditionalBase.join(", "),o.style.border="1px solid #ddd",o.style.padding="10px",o.style.textAlign="center",t.appendChild(o);const l=document.createElement("td");l.textContent=e.fpTree.join(", "),l.style.border="1px solid #ddd",l.style.padding="10px",l.style.textAlign="center",t.appendChild(l);const r=document.createElement("td");r.textContent=e.frequentPatterns.join(", "),r.style.border="1px solid #ddd",r.style.padding="10px",r.style.textAlign="center",t.appendChild(r),i.appendChild(t)})),o.appendChild(i),n.appendChild(o),t.appendChild(n)}(a)}(i):function(e){try{const t=parseInt(u.value),n=parseInt(f.value);if(isNaN(t)||t<2)return void alert("Number of clusters must be at least 2");if(isNaN(n)||n<1)return void alert("Max iterations must be a positive number");const o=l(e);function l(e){return e.split("\n").map((e=>e.trim())).filter((e=>e)).map((e=>{const t=e.split(",").map((e=>parseFloat(e.trim())));if(t.some(isNaN))throw new Error("Invalid data point: All values must be numeric.");const n={};return t.forEach(((e,t)=>{n[`dimension_${t+1}`]=e})),n}))}if(0===o.length)return void alert("No valid data points found. Please check your input.");if(o.length<t)return void alert(`Cannot create ${t} clusters from ${o.length} data points. Please reduce K or add more data.`);const i=performance.now(),d=$(o),c=[];d.length>0&&d[0].length>=2&&(c.push({dimension_1:1,dimension_2:1}),c.push({dimension_1:2,dimension_2:1}),c.push({dimension_1:4,dimension_2:3}),c.push({dimension_1:5,dimension_2:4}));const p=$(c);!function(e){const t=document.createElement("div");t.className="input-data-table",t.innerHTML="<h3>Input Data Points:</h3>";const n=document.createElement("table");n.style.width="100%",n.style.borderCollapse="collapse",n.style.margin="15px 0",n.style.border="1px solid #ddd";const o=document.createElement("thead"),l=document.createElement("tr"),r=document.createElement("th");if(r.textContent="Point",r.style.border="1px solid #ddd",r.style.padding="8px",r.style.backgroundColor="#f2f2f2",l.appendChild(r),e.length>0)for(let t=0;t<e[0].length;t++){const e=document.createElement("th");e.textContent=`Dimension ${t+1}`,e.style.border="1px solid #ddd",e.style.padding="8px",e.style.backgroundColor="#f2f2f2",l.appendChild(e)}o.appendChild(l),n.appendChild(o);const i=document.createElement("tbody");e.forEach(((e,t)=>{const n=document.createElement("tr"),o=document.createElement("td");o.textContent=`P${t+1}`,o.style.border="1px solid #ddd",o.style.padding="8px",n.appendChild(o),e.forEach((e=>{const t=document.createElement("td");t.textContent=e.toString(),t.style.border="1px solid #ddd",t.style.padding="8px",n.appendChild(t)})),i.appendChild(n)})),n.appendChild(i),t.appendChild(n);const d=document.getElementById("frequent-itemsets");d&&d.appendChild(t)}(d);const h=new r(t,n).dichuyenvoidulieu(d);!function(e,t,n,o){a.innerHTML="",s.textContent=`Đã thực hiện K-means với ${e.tamcum.length} cụm trong ${t.toFixed(1)}ms. Số vòng lặp: ${e.solap}`;const l=document.createElement("div");l.className="kmeans-results";const r=document.createElement("div");r.innerHTML="<h3>Dữ liệu đầu vào:</h3>";const i=document.createElement("table");i.className="data-table",i.style.width="100%",i.style.borderCollapse="collapse",i.style.margin="20px 0",i.style.border="2px solid #ddd";const d=document.createElement("thead"),c=document.createElement("tr"),p=document.createElement("th");if(p.textContent="Điểm",p.style.border="1px solid #ddd",p.style.padding="10px",p.style.backgroundColor="#f2f2f2",p.style.fontWeight="bold",c.appendChild(p),n.length>0)for(let e=0;e<n[0].length;e++){const t=document.createElement("th");t.textContent=`Tọa độ ${e+1}`,t.style.border="1px solid #ddd",t.style.padding="10px",t.style.backgroundColor="#f2f2f2",t.style.fontWeight="bold",c.appendChild(t)}d.appendChild(c),i.appendChild(d);const h=document.createElement("tbody");n.forEach(((e,t)=>{const n=document.createElement("tr"),o=document.createElement("td");o.textContent=`Điểm ${t+1}`,o.style.border="1px solid #ddd",o.style.padding="10px",o.style.textAlign="center",n.appendChild(o),e.forEach((e=>{const t=document.createElement("td");t.textContent=(Math.round(10*e)/10).toFixed(1),t.style.border="1px solid #ddd",t.style.padding="10px",t.style.textAlign="center",n.appendChild(t)})),h.appendChild(n)})),i.appendChild(h),r.appendChild(i),l.appendChild(r);const m=document.createElement("div");m.innerHTML=`<h3>Tâm cụm ban đầu (Số cụm k = ${e.chitietlap[0].tamcum.length}):</h3>`;const u=document.createElement("table");u.className="centroid-table",u.style.width="100%",u.style.borderCollapse="collapse",u.style.margin="20px 0",u.style.border="2px solid #ddd";const f=document.createElement("thead"),y=document.createElement("tr"),x=document.createElement("th");if(x.textContent="Tâm cụm",x.style.border="1px solid #ddd",x.style.padding="10px",x.style.backgroundColor="#f2f2f2",x.style.fontWeight="bold",y.appendChild(x),e.chitietlap[0].tamcum.length>0)for(let t=0;t<e.chitietlap[0].tamcum[0].length;t++){const e=document.createElement("th");e.textContent=`Tọa độ ${t+1}`,e.style.border="1px solid #ddd",e.style.padding="10px",e.style.backgroundColor="#f2f2f2",e.style.fontWeight="bold",y.appendChild(e)}f.appendChild(y),u.appendChild(f);const C=document.createElement("tbody");e.chitietlap[0].tamcum.forEach(((e,t)=>{const n=document.createElement("tr"),o=document.createElement("td");o.textContent=`Tâm cụm ${t+1}`,o.style.border="1px solid #ddd",o.style.padding="10px",o.style.textAlign="center",n.appendChild(o),e.forEach((e=>{const t=document.createElement("td");t.textContent=(Math.round(10*e)/10).toFixed(1),t.style.border="1px solid #ddd",t.style.padding="10px",t.style.textAlign="center",n.appendChild(t)})),C.appendChild(n)})),u.appendChild(C),m.appendChild(u),l.appendChild(m);const v=document.createElement("div");v.innerHTML="<h3>Chi tiết từng vòng lặp:</h3>";const b=document.createElement("div");b.className="iterations-accordion",b.style.border="1px solid #ddd",b.style.borderRadius="5px",b.style.marginBottom="30px",e.chitietlap.forEach(((t,l)=>{const r=document.createElement("div");r.className="iteration-header",r.textContent=`Vòng lặp ${l+1}`,r.style.padding="12px 15px",r.style.backgroundColor="#f2f2f2",r.style.borderBottom="1px solid #ddd",r.style.cursor="pointer",r.style.fontWeight="bold",r.style.fontSize="16px",0===l&&(r.style.backgroundColor="#e0e0e0");const i=document.createElement("div");i.className="iteration-content",i.style.padding="20px",i.style.backgroundColor="#fafafa",i.style.display=0===l?"block":"none";const d=document.createElement("div");d.innerHTML="<h4>Tính khoảng cách Euclid:</h4>";const a=document.createElement("table");a.className="distances-table",a.style.width="100%",a.style.borderCollapse="collapse",a.style.margin="15px 0",a.style.border="1px solid #ddd";const s=document.createElement("thead"),c=document.createElement("tr");["Điểm","Phép tính khoảng cách Euclid","Kết quả khoảng cách","Kết luận"].forEach((e=>{const t=document.createElement("th");t.textContent=e,t.style.border="1px solid #ddd",t.style.padding="10px",t.style.backgroundColor="#f2f2f2",t.style.fontWeight="bold",c.appendChild(t)})),s.appendChild(c),a.appendChild(s);const p=document.createElement("tbody");n.forEach(((e,n)=>{const o=document.createElement("tr"),l=document.createElement("td");l.textContent=`Điểm ${n+1}`,l.style.border="1px solid #ddd",l.style.padding="10px",l.style.verticalAlign="top",o.appendChild(l);const r=document.createElement("td");r.style.border="1px solid #ddd",r.style.padding="10px",r.style.verticalAlign="top";const i=document.createElement("div"),d=[];t.tamcum.forEach(((t,n)=>{let o=0;const l=[];for(let n=0;n<e.length;n++){const r=e[n]-t[n],i=r*r;o+=i,l.push(`(${(Math.round(10*e[n])/10).toFixed(1)} - ${(Math.round(10*t[n])/10).toFixed(1)})² = ${(Math.round(10*i)/10).toFixed(1)}`)}const r=Math.sqrt(o);d.push(r);const a=document.createElement("div");a.style.marginBottom="12px",a.innerHTML=`\n                        <strong>Đến tâm cụm ${n+1}:</strong><br>\n                        d = √(${l.join(" + ")}) = √${(Math.round(10*o)/10).toFixed(1)} = ${(Math.round(10*r)/10).toFixed(1)}\n                    `,i.appendChild(a)})),r.appendChild(i),o.appendChild(r);const a=document.createElement("td");a.style.border="1px solid #ddd",a.style.padding="10px",a.style.verticalAlign="top";const s=document.createElement("ul");s.style.listStyleType="none",s.style.padding="0",s.style.margin="0",d.forEach(((e,t)=>{const n=document.createElement("li");n.style.marginBottom="5px",n.textContent=`Khoảng cách đến tâm cụm ${t+1}: ${(Math.round(10*e)/10).toFixed(1)}`,s.appendChild(n)})),a.appendChild(s),o.appendChild(a);const c=t.phancum[n],h=Math.min(...d),m=d.indexOf(h),u=document.createElement("td");u.style.border="1px solid #ddd",u.style.padding="10px",u.style.verticalAlign="top";const f=document.createElement("div");f.innerHTML=`<strong>Điểm ${n+1} được gán vào Cụm ${c+1}</strong> vì:`;const g=document.createElement("ul");g.style.marginTop="5px",d.forEach(((e,t)=>{const n=document.createElement("li");n.innerHTML=t===m?`<strong style="color: green;">Khoảng cách đến Tâm cụm ${t+1} = ${(Math.round(10*e)/10).toFixed(1)} (nhỏ nhất)</strong>`:`Khoảng cách đến Tâm cụm ${t+1} = ${(Math.round(10*e)/10).toFixed(1)} > ${(Math.round(10*h)/10).toFixed(1)}`,g.appendChild(n)})),f.appendChild(g),u.appendChild(f),o.appendChild(u),p.appendChild(o)})),a.appendChild(p),d.appendChild(a),i.appendChild(d);const h=document.createElement("div");h.innerHTML="<h4>Bảng phân cụm:</h4>";const m={};t.phancum.forEach(((e,t)=>{m[e]||(m[e]=[]),m[e].push(t)}));const u=document.createElement("table");u.className="assignments-table",u.style.width="100%",u.style.borderCollapse="collapse",u.style.margin="15px 0",u.style.border="1px solid #ddd";const f=document.createElement("thead"),g=document.createElement("tr"),y=document.createElement("th");y.textContent="Cụm",y.style.border="1px solid #ddd",y.style.padding="10px",y.style.backgroundColor="#f2f2f2",g.appendChild(y);const x=document.createElement("th");x.textContent="Các điểm trong cụm",x.style.border="1px solid #ddd",x.style.padding="10px",x.style.backgroundColor="#f2f2f2",g.appendChild(x);const C=document.createElement("th");C.textContent="Số lượng",C.style.border="1px solid #ddd",C.style.padding="10px",C.style.backgroundColor="#f2f2f2",g.appendChild(C),f.appendChild(g),u.appendChild(f);const v=document.createElement("tbody");if(Object.keys(m).sort(((e,t)=>Number(e)-Number(t))).forEach((e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=`Cụm ${Number(e)+1}`,n.style.border="1px solid #ddd",n.style.padding="10px",n.style.textAlign="center",n.style.fontWeight="bold",t.appendChild(n);const o=document.createElement("td");o.style.border="1px solid #ddd",o.style.padding="10px",o.textContent=m[Number(e)].map((e=>`Điểm ${e+1}`)).join(", "),t.appendChild(o);const l=document.createElement("td");l.textContent=m[Number(e)].length.toString(),l.style.border="1px solid #ddd",l.style.padding="10px",l.style.textAlign="center",t.appendChild(l),v.appendChild(t)})),u.appendChild(v),h.appendChild(u),i.appendChild(h),l<e.chitietlap.length-1){const o=document.createElement("div");o.innerHTML="<h4>Tính toán tâm cụm mới:</h4>";const r=document.createElement("table");r.className="centroid-update-table",r.style.width="100%",r.style.borderCollapse="collapse",r.style.margin="15px 0",r.style.border="1px solid #ddd";const d=document.createElement("thead"),a=document.createElement("tr");["Cụm","Các điểm trong cụm","Phép tính tâm cụm mới","Tâm cụm mới","Thay đổi?"].forEach((e=>{const t=document.createElement("th");t.textContent=e,t.style.border="1px solid #ddd",t.style.padding="10px",t.style.backgroundColor="#f2f2f2",a.appendChild(t)})),d.appendChild(a),r.appendChild(d);const s=document.createElement("tbody"),c={};n.forEach(((e,n)=>{const o=t.phancum[n];c[o]||(c[o]=[]),c[o].push(e)})),Object.keys(c).sort(((e,t)=>Number(e)-Number(t))).forEach((o=>{const r=Number(o),i=document.createElement("tr"),d=document.createElement("td");d.textContent=`Cụm ${r+1}`,d.style.border="1px solid #ddd",d.style.padding="10px",d.style.verticalAlign="top",d.style.fontWeight="bold",i.appendChild(d);const a=document.createElement("td");a.style.border="1px solid #ddd",a.style.padding="10px",a.style.verticalAlign="top";const p=document.createElement("div"),h=c[r];0===h.length?p.textContent="Cụm rỗng":h.forEach(((e,t)=>{const o=n.findIndex((t=>t.every(((t,n)=>t===e[n])))),l=document.createElement("div");l.style.marginBottom="5px",l.textContent=`Điểm ${o+1}: (${e.join(", ")})`,p.appendChild(l)})),a.appendChild(p),i.appendChild(a);const m=document.createElement("td");m.style.border="1px solid #ddd",m.style.padding="10px",m.style.verticalAlign="top";const u=document.createElement("div"),f=c[r];if(0===f.length)u.innerHTML="<em>Giữ nguyên tâm cụm cũ (cụm rỗng)</em>";else{const e=f[0].length;for(let t=0;t<e;t++){const e=document.createElement("div");e.style.marginBottom="8px";let n=`<strong>Tọa độ ${t+1}</strong> = (`,o=0;f.forEach(((e,l)=>{o+=e[t],n+=e[t],l<f.length-1&&(n+=" + ")}));const l=o/f.length;n+=`) / ${f.length} = ${o} / ${f.length} = ${l.toFixed(4)}`,e.innerHTML=n,u.appendChild(e)}}m.appendChild(u),i.appendChild(m);const g=document.createElement("td");g.style.border="1px solid #ddd",g.style.padding="10px",g.style.verticalAlign="top";const y=e.chitietlap[l+1].tamcum[r];g.textContent=`(${y.map((e=>e.toFixed(4))).join(", ")})`,i.appendChild(g);const x=document.createElement("td");x.style.border="1px solid #ddd",x.style.padding="10px",x.style.verticalAlign="top",x.style.textAlign="center";const C=t.tamcum[r],v=e.chitietlap[l+1].tamcum[r];let b=0;for(let e=0;e<C.length;e++){const t=C[e]-v[e];b+=t*t}const E=Math.sqrt(b),T=E>1e-4;x.innerHTML=T?`<span style="color: red; font-weight: bold;">Có (khoảng cách = ${E.toFixed(6)})</span>`:`<span style="color: green; font-weight: bold;">Không (khoảng cách = ${E.toFixed(6)})</span>`,i.appendChild(x),s.appendChild(i)})),r.appendChild(s),o.appendChild(r),i.appendChild(o)}const E=document.createElement("div");E.innerHTML="<h4>Biểu đồ phân cụm:</h4>",E.style.marginTop="20px";const T=document.createElement("canvas");T.width=500,T.height=400,T.style.backgroundColor="#ffffff",T.style.border="1px solid #ddd",T.style.borderRadius="5px",T.style.marginTop="10px",E.appendChild(T);setTimeout((()=>{const e=T.getContext("2d");if(!e)return;if(n[0].length<2)return e.font="14px Arial",void e.fillText("Cần ít nhất 2 chiều dữ liệu để hiển thị",50,50);let l=1/0,r=-1/0,i=1/0,d=-1/0;n.forEach((e=>{l=Math.min(l,e[0]),r=Math.max(r,e[0]),i=Math.min(i,e[1]),d=Math.max(d,e[1])})),o&&o.length>0&&o.forEach((e=>{e.length>0&&e.length>1&&(l=Math.min(l,e[0]),r=Math.max(r,e[0]),i=Math.min(i,e[1]),d=Math.max(d,e[1]))}));const a=.1*(r-l),s=.1*(d-i);l-=a,r+=a,i-=s,d+=s;const c=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],p=e=>(e-l)/(r-l)*T.width*.8+.05*T.width,h=e=>T.height-((e-i)/(d-i)*T.height*.8+.05*T.height);e.clearRect(0,0,T.width,T.height),e.strokeStyle="#888",e.lineWidth=1,e.beginPath(),e.moveTo(p(l),h(0)),e.lineTo(p(r),h(0)),e.moveTo(p(0),h(i)),e.lineTo(p(0),h(d)),e.stroke(),e.font="12px Arial",e.fillStyle="#333",e.textAlign="center",e.fillText("Tọa độ 1",T.width/2,T.height-5),e.save(),e.translate(10,T.height/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Tọa độ 2",0,0),e.restore(),n.forEach(((n,o)=>{const l=t.phancum[o],r=c[l%c.length];e.fillStyle=r,e.beginPath(),e.arc(p(n[0]),h(n[1]),6,0,2*Math.PI),e.fill(),e.fillStyle="#333",e.font="11px Arial",e.textAlign="center",e.fillText(`${o+1}`,p(n[0]),h(n[1])-8)})),t.tamcum.forEach(((t,n)=>{const o=c[n%c.length];e.strokeStyle=o,e.lineWidth=2,e.fillStyle="#fff",e.beginPath(),e.arc(p(t[0]),h(t[1]),8,0,2*Math.PI),e.fill(),e.stroke(),e.fillStyle="#000",e.font="12px Arial",e.textAlign="center",e.fillText(`C${n+1}`,p(t[0]),h(t[1])-12)}));const m=T.width-100;let u=30;e.font="12px Arial",e.textAlign="left",e.fillStyle="#333",e.fillText("Chú thích:",m-30,u-15),t.tamcum.forEach(((t,n)=>{const o=c[n%c.length];e.fillStyle=o,e.beginPath(),e.arc(m,u,6,0,2*Math.PI),e.fill(),e.fillStyle="#333",e.fillText(`Cụm ${n+1}`,m+15,u+4),u+=20}))}),0),i.appendChild(E),r.addEventListener("click",(()=>{const e="block"===i.style.display;i.style.display=e?"none":"block",r.style.backgroundColor=e?"#f2f2f2":"#e0e0e0"})),b.appendChild(r),b.appendChild(i)})),v.appendChild(b),l.appendChild(v);const E=document.createElement("div");E.innerHTML="<h3>Kết quả phân cụm cuối cùng:</h3>";const T=document.createElement("table");T.className="final-centroids-table",T.style.width="100%",T.style.borderCollapse="collapse",T.style.margin="15px 0",T.style.border="2px solid #ddd";const w=document.createElement("thead"),$=document.createElement("tr");["Cụm","Số lượng điểm",...Array.from({length:e.tamcum[0].length},((e,t)=>`Tọa độ ${t+1}`))].forEach((e=>{const t=document.createElement("th");t.textContent=e,t.style.border="1px solid #ddd",t.style.padding="10px",t.style.backgroundColor="#f2f2f2",t.style.fontWeight="bold",$.appendChild(t)})),w.appendChild($),T.appendChild(w);const M=document.createElement("tbody");e.tamcum.forEach(((t,n)=>{const o=document.createElement("tr"),l=document.createElement("td");l.textContent=`Cụm ${n+1}`,l.style.border="1px solid #ddd",l.style.padding="10px",l.style.textAlign="center",l.style.fontWeight="bold",o.appendChild(l);const r=document.createElement("td");r.textContent=e.nhomcum[n].length.toString(),r.style.border="1px solid #ddd",r.style.padding="10px",r.style.textAlign="center",o.appendChild(r),t.forEach((e=>{const t=document.createElement("td");t.textContent=(Math.round(10*e)/10).toFixed(1),t.style.border="1px solid #ddd",t.style.padding="10px",t.style.textAlign="center",o.appendChild(t)})),M.appendChild(o)})),T.appendChild(M),E.appendChild(T),l.appendChild(E);const k=document.createElement("div");k.innerHTML="<h3>Biểu đồ phân cụm cuối cùng:</h3>";const L=document.createElement("div");L.style.display="flex",L.style.flexDirection="column",L.style.alignItems="center",L.style.marginTop="20px";const A=document.createElement("canvas");A.width=600,A.height=450,A.style.backgroundColor="#ffffff",A.style.border="1px solid #ddd",A.style.borderRadius="5px";const I=document.createElement("div");if(I.style.margin="15px 0",I.style.textAlign="center",n[0].length>2&&(I.innerHTML='\n                <label for="x-axis">Trục X:</label>\n                <select id="x-axis" style="margin: 0 10px;"></select>\n\n                <label for="y-axis">Trục Y:</label>\n                <select id="y-axis" style="margin: 0 10px;"></select>\n\n                <button id="update-viz" style="margin-left: 10px; padding: 5px 10px;">Cập nhật</button>\n            ',L.appendChild(I)),L.appendChild(A),k.appendChild(L),l.appendChild(k),a.appendChild(l),n[0].length>2){const e=document.getElementById("x-axis"),t=document.getElementById("y-axis"),o=document.getElementById("update-viz");if(e&&t){for(let o=0;o<n[0].length;o++){const n=document.createElement("option");n.value=o.toString(),n.textContent=`Tọa độ ${o+1}`,e.appendChild(n);const l=document.createElement("option");l.value=o.toString(),l.textContent=`Tọa độ ${o+1}`,t.appendChild(l)}e.value="0",t.value=n[0].length>1?"1":"0",S(0,n[0].length>1?1:0),o.addEventListener("click",(()=>{S(parseInt(e.value),parseInt(t.value))}))}}else S(0,n[0].length>1?1:0);function S(t,l){const r=A.getContext("2d");if(!r)return;if(n[0].length<2&&t!==l)return r.font="14px Arial",r.fillStyle="#333",r.textAlign="center",void r.fillText("Chỉ có 1 chiều dữ liệu, không thể vẽ đồ thị 2D",A.width/2,A.height/2);let i=1/0,d=-1/0,a=1/0,s=-1/0;n.forEach((e=>{i=Math.min(i,e[t]),d=Math.max(d,e[t]),a=Math.min(a,e[l]),s=Math.max(s,e[l])})),o&&o.length>0&&o.forEach((e=>{e.length>t&&e.length>l&&(i=Math.min(i,e[t]),d=Math.max(d,e[t]),a=Math.min(a,e[l]),s=Math.max(s,e[l]))}));const c=.1*(d-i)||.1,p=.1*(s-a)||.1;i-=c,d+=c,a-=p,s+=p;const h=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],m=e=>(e-i)/(d-i)*A.width*.8+.1*A.width,u=e=>A.height-((e-a)/(s-a)*A.height*.8+.1*A.height);r.clearRect(0,0,A.width,A.height),r.strokeStyle="#eee",r.lineWidth=1;for(let e=i;e<=d;e+=(d-i)/10)r.beginPath(),r.moveTo(m(e),u(a)),r.lineTo(m(e),u(s)),r.stroke();for(let e=a;e<=s;e+=(s-a)/10)r.beginPath(),r.moveTo(m(i),u(e)),r.lineTo(m(d),u(e)),r.stroke();r.strokeStyle="#888",r.lineWidth=2,r.beginPath(),r.moveTo(m(i),u(0)),r.lineTo(m(d),u(0)),r.moveTo(m(0),u(a)),r.lineTo(m(0),u(s)),r.stroke(),r.font="14px Arial",r.fillStyle="#333",r.textAlign="center",r.fillText(`Tọa độ ${t+1}`,A.width/2,A.height-10),r.save(),r.translate(15,A.height/2),r.rotate(-Math.PI/2),r.textAlign="center",r.fillText(`Tọa độ ${l+1}`,0,0),r.restore();const f=e.chitietlap[e.chitietlap.length-1].phancum;n.forEach(((e,n)=>{const o=f[n],i=h[o%h.length];r.fillStyle=i,r.beginPath(),r.arc(m(e[t]),u(e[l]),7,0,2*Math.PI),r.fill(),r.fillStyle="#333",r.font="11px Arial",r.textAlign="center",r.fillText(`${n+1}`,m(e[t]),u(e[l])-10)})),e.tamcum.forEach(((e,n)=>{const o=h[n%h.length];r.strokeStyle=o,r.lineWidth=2,r.fillStyle="#fff",r.beginPath(),r.arc(m(e[t]),u(e[l]),10,0,2*Math.PI),r.fill(),r.stroke(),r.fillStyle="#000",r.font="14px Arial",r.textAlign="center",r.fillText(`C${n+1}`,m(e[t]),u(e[l])-15)}));const g=A.width-150;let y=30;r.font="14px Arial",r.textAlign="left",r.fillStyle="#333",r.fillText("Chú thích:",g-10,y-15),e.tamcum.forEach(((t,n)=>{const o=h[n%h.length];r.fillStyle=o,r.beginPath(),r.arc(g,y,7,0,2*Math.PI),r.fill(),r.fillStyle="#333",r.fillText(`Cụm ${n+1} (${e.nhomcum[n].length})`,g+15,y+5),y+=25}))}if(g.style.display="block","function"==typeof window.setupClusterVisualizationFromNumeric){const t=e.chitietlap[e.chitietlap.length-1].phancum;window.setupClusterVisualizationFromNumeric(n,t,e.tamcum)}"function"==typeof window.createConvergenceAnimation&&window.createConvergenceAnimation(n,e.chitietlap)}(h,performance.now()-i,d,p)}catch(m){console.error("Error executing K-means:",m),s.textContent=`Error: ${m.message}`}}(i)):alert("Please enter data")}))}))})();